name: Release

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.27.x'  # withValuesãƒ¡ã‚½ãƒƒãƒ‰å¯¾å¿œã®ãŸã‚æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³
          channel: 'stable'
          cache: true

      - name: Verify Flutter installation
        run: flutter --version

      - name: Install dependencies
        run: flutter pub get

      - name: Analyze project source
        run: flutter analyze --fatal-infos

      - name: Run tests
        run: flutter test

      - name: Build for web
        run: flutter build web --release

      - name: Create Release
        uses: softprops/action-gh-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          name: æ°´æ»¸ä¼æˆ¦ç•¥ã‚²ãƒ¼ãƒ  ${{ github.ref_name }}
          body: |
            ## ğŸ® æ°´æ»¸ä¼æˆ¦ç•¥ã‚²ãƒ¼ãƒ  - ãƒãƒ¼ã‚¸ãƒ§ãƒ³ ${{ github.ref_name }}
            
            ### ğŸ¯ ä»Šã™ããƒ—ãƒ¬ã‚¤
            **[GitHub Pages ã§ãƒ—ãƒ¬ã‚¤](https://iori.github.io/AllMenAreBrothers/)**
            
            ### ğŸ“± å¯¾å¿œãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 
            - âœ… **Webç‰ˆ**: ä¸Šè¨˜ãƒªãƒ³ã‚¯ã‹ã‚‰å³åº§ã«ãƒ—ãƒ¬ã‚¤
            - ğŸ”„ **Androidç‰ˆ**: é–‹ç™ºä¸­
            - ğŸ”„ **iOSç‰ˆ**: é–‹ç™ºä¸­
            
            ### ğŸ†• ã“ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å¤‰æ›´ç‚¹
            <!-- å¤‰æ›´å†…å®¹ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„ -->
            - æ–°æ©Ÿèƒ½ã®è¿½åŠ 
            - ãƒã‚°ä¿®æ­£
            - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„
            
            ### ğŸ› ï¸ æŠ€è¡“ä»•æ§˜
            - **Flutter**: 3.27.0
            - **ãƒ“ãƒ«ãƒ‰æ—¥æ™‚**: ${{ github.event.head_commit.timestamp }}
            - **ã‚³ãƒŸãƒƒãƒˆ**: ${{ github.sha }}
          draft: false
          prerelease: false
