# 水滸伝戦略ゲーム - Copilot Instructions

<!-- Use this file to provide workspace-specific custom instructions to Copilot. For more details, visit https://code.visualstudio.com/docs/copilot/copilot-customization#_use-a-githubcopilotinstructionsmd-file -->

## プロジェクト概要

このプロジェクトは、中国古典小説「水滸伝」を題材にしたターン制戦略シミュレーションゲームです。北宋時代を舞台に、梁山泊を拠点として天下統一を目指す Flutter アプリケーションです。

## コーディング指針

### ゲーム設計

- **ターン制戦略ゲーム**: プレイヤーのターンと敵 AI のターンを交互に実行
- **州管理システム**: 各州には人口、農業、商業、治安、軍事、民心の 6 つのパラメータ
- **勢力システム**: 梁山泊（プレイヤー）、朝廷、豪族、中立、盗賊の 5 つの勢力
- **歴史的リアリティ**: 水滸伝の世界観と北宋時代の歴史を重視

#### 経済活動の詳細設計

- 経済活動は「農業」「商業」「税収」「交易」「資源管理」など複数の要素で構成し、各州ごとに個別パラメータを持つ。
- 州ごとの経済力は、人口・地理・治安・民心・勢力の影響を受け、季節やイベントで変動。
- プレイヤーは「徴税」「投資」「交易路開設」「市場建設」「資源分配」などのアクションを選択可能。
- 商業・交易は他州や他勢力との関係性（友好度・外交・治安）によって収益やリスクが変化。
- 農業は天候・災害・技術・労働力で収穫量が変動し、食糧不足や豊作イベントが発生。
- 資源（米・塩・鉄・布など）は州ごとに産出量・需要・価格が異なり、交易や戦争で価格が変動。
- 経済活動の結果は「民心」「治安」「軍事力」「発展度」に影響し、バランスを取る必要がある。
- AI 勢力も独自の経済戦略を持ち、プレイヤーと競合・協調する。
- 経済パラメータは毎ターン自動計算され、イベントや政策で一時的な変動が起こる。
- UI では州ごとの経済状況をグラフやアイコンで可視化し、直感的に操作できるようにする。

---

#### 経済活動のパラメータ設計と計算式

- 各州の経済パラメータ

  - 人口（population）
  - 農業力（agriculture）
  - 商業力（commerce）
  - 治安（security）
  - 民心（publicSupport）
  - 軍事力（military）
  - 資源（resources: 米・塩・鉄・布など）
  - 発展度（development）

- 経済活動の主要値

  - 税収（taxIncome）
    - 計算式例:  
      `taxIncome = (population × taxRate × publicSupport × security) × 勢力補正`
  - 農業収穫量（agricultureYield）
    - 計算式例:  
      `agricultureYield = (agriculture × population × 技術補正 × 天候補正 × 災害補正) × 民心補正`
  - 商業収益（commerceIncome）
    - 計算式例:  
      `commerceIncome = (commerce × population × 治安補正 × 交易路数 × 他州友好度) × 市場補正`
  - 資源産出量（resourceYield）
    - 計算式例:  
      `resourceYield = Σ(資源ごとに: baseYield × 地理補正 × 労働力補正 × 需要補正)`
  - 交易収益（tradeIncome）
    - 計算式例:  
      `tradeIncome = (交易量 × 交易相手の需要 × 治安 × 友好度) × 価格変動`
  - 発展度（development）
    - 計算式例:  
      `development = (農業収穫量 + 商業収益 + 資源産出量) × 投資補正 × イベント補正`

- パラメータ間の関係性

  - 治安が低いと税収・商業収益・交易収益が減少し、災害・盗賊イベントが発生しやすくなる
  - 民心が高いと税収・農業収穫量が増加し、反乱リスクが低下
  - 軍事力が高いと治安維持・資源防衛に有利
  - 資源価格は需給・戦争・イベントで変動
  - 投資や政策で一時的な補正がかかる

- AI 勢力も同様の計算式で経済活動を行い、戦略に応じてパラメータを変動させる

### Dart コーディング規約

- **イミュータブルデザイン**: できる限り final や const を使用
- **関数型プログラミング**: 副作用を避け、純粋関数を優先
- **型安全性**: 明示的な型注釈と null 安全性の活用
- **日本語コメント**: クラス、メソッド、重要なロジックには日本語での説明を記載

### ファイル構成

- `lib/models/`: ゲームのデータモデル（Province, Faction, GameState 等）
- `lib/data/`: 静的データ（マップデータ、初期設定等）
- `lib/screens/`: UI 画面（メインマップ、州詳細、戦闘画面等）
- `lib/widgets/`: 再利用可能な UI コンポーネント
- `lib/services/`: ゲームロジック、AI、セーブ/ロード機能

### UI/UX 指針

- **中国古典風デザイン**: 水滸伝の世界観に合った色彩とフォント
- **直感的操作**: タップで州選択、スワイプでマップ移動
- **情報の可視化**: 州のステータスを分かりやすくグラフィカルに表示
- **レスポンシブ**: タブレットとスマートフォンの両方に対応

### パフォーマンス

- **軽量な描画**: 大量の州データを効率的に描画
- **メモリ管理**: ゲーム状態の適切な管理とクリーンアップ
- **バックグラウンド処理**: AI の思考時間を最小化

### テスト

- **ユニットテスト**: ゲームロジックの重要な部分をテスト
- **ウィジェットテスト**: UI コンポーネントの動作確認
- **統合テスト**: ゲーム全体のフローをテスト
